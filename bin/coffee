#!/usr/bin/env ruby -s
$:.unshift File.dirname(__FILE__) + "/../lib"
require "coffee"

if $h
  puts <<-EOS

            ~== 0xCOFFEE ==~

             To run a file
         coffee cappuccino.cof

       To compile to LLVM bytecode
    coffee -c=delicious.o creamy.cof

  EOS
  exit
end

file = ARGV.first
abort "Usage: coffee [-hiO] [-c=file.o] file.cof" unless file

g = Coffee.compile(File.read(file))
g.optimize unless $O

case
when $i: puts g.inspect
when $c: g.to_file(TrueClass === $c ? file + ".o" : $c)
else     g.run
end